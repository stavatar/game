# Product Requirements Document (PRD)

## Базис и Надстройка - Симулятор Развития Общества

**Версия:** 1.0
**Дата:** 2026-01-31
**Статус:** В разработке
**Автор:** PM Agent (BMAD Method)

---

## 1. Обзор Проекта (Project Overview)

### 1.1 Резюме (Executive Summary)

**Базис и Надстройка** — это агентная симуляция развития человеческого общества, основанная на марксистской теории исторического материализма. Проект моделирует, как экономический базис (производительные силы и производственные отношения) определяет культурную надстройку (идеологию, верования, традиции).

Каждый NPC (Non-Player Character) в симуляции является уникальной автономной личностью с собственной генетикой, памятью, личностью и способностью принимать самостоятельные решения через BDI-архитектуру (Beliefs-Desires-Intentions).

### 1.2 Проблема (Problem Statement)

Существующие симуляторы обществ страдают от следующих проблем:
- **Жёсткие классовые системы**: Классы задаются программистом, а не возникают естественно
- **Плоские NPC**: Персонажи не имеют настоящей памяти, личности и автономии
- **Отсутствие причинно-следственных связей**: Культура не зависит от экономики
- **Детерминистическое поведение**: NPC следуют жёстким скриптам

### 1.3 Решение (Solution)

Emergent-система, где:
- Классы **возникают** из экономических отношений, а не задаются
- Культура **формируется** из условий жизни
- Каждый NPC — **уникальная личность** с памятью и целями
- Все явления имеют **причинно-следственные связи**

### 1.4 Целевая Аудитория (Target Audience)

| Персона | Описание | Потребности |
|---------|----------|-------------|
| Исследователь | Изучает emergent-системы и агентное моделирование | Наблюдение за развитием общества, сбор статистики |
| Разработчик игр | Ищет референсы для AI систем в играх | Изучение архитектуры поведения NPC |
| Студент/Преподаватель | Изучает марксистскую теорию | Визуализация исторического материализма |
| Энтузиаст симуляций | Любит Dwarf Fortress, RimWorld | Наблюдение за "историями, которые рассказывают себя сами" |

---

## 2. Цели и Метрики Успеха (Goals & Success Metrics)

### 2.1 Бизнес-Цели

| ID | Цель | Описание |
|----|------|----------|
| BG-01 | Исследовательская платформа | Создать инструмент для изучения emergent-систем |
| BG-02 | Образовательный проект | Демонстрация марксистской теории через симуляцию |
| BG-03 | Open Source вклад | Развитие методов агентного моделирования |

### 2.2 Пользовательские Цели

| ID | Цель | Описание |
|----|------|----------|
| UG-01 | Наблюдение | Пользователь может наблюдать за развитием общества |
| UG-02 | Понимание | Пользователь понимает связь базиса и надстройки |
| UG-03 | Эксперименты | Пользователь может менять начальные условия |

### 2.3 Метрики Успеха (KPIs)

| ID | Метрика | Целевое значение | Способ измерения |
|----|---------|------------------|------------------|
| KPI-01 | Возникновение классов | Классы появляются за 50-100 лет симуляции | Логи системы классов |
| KPI-02 | Технологический прогресс | Переход между эпохами каждые 200-500 лет | Трекинг технологий |
| KPI-03 | Уникальность NPC | 0% идентичных NPC в популяции | Сравнение характеристик |
| KPI-04 | Причинно-следственные связи | 100% верований имеют экономический источник | Анализ BeliefOrigin |

---

## 3. Функциональные Требования (Functional Requirements)

### 3.1 Ядро Симуляции (Core Simulation)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-001 | Система должна поддерживать дискретное время (часы, дни, месяцы, годы) | P0 | Done |
| FR-002 | Симуляция должна обновлять все подсистемы в правильном порядке (базис → общество → надстройка → NPC) | P0 | Done |
| FR-003 | Система событий (EventBus) должна поддерживать pub/sub паттерн | P0 | Done |
| FR-004 | События должны иметь уровни важности (TRIVIAL → HISTORIC) | P0 | Done |
| FR-005 | Система должна поддерживать конфигурируемые пресеты (Realistic, Accelerated, Sandbox) | P1 | Done |

### 3.2 Мир и Окружение (World & Environment)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-010 | Карта должна быть сеткой с координатами (по умолчанию 40x40) | P0 | Done |
| FR-011 | Локации должны иметь типы (поле, лес, озеро, поселение, пещера) | P0 | Done |
| FR-012 | Система сезонов (весна, лето, осень, зима) с влиянием на ресурсы | P0 | Done |
| FR-013 | Климатические катаклизмы (засуха, мор, голод, саранча) | P1 | Done |
| FR-014 | Время суток должно влиять на поведение NPC | P1 | Done |
| FR-015 | Локации должны хранить NPC и ресурсы | P0 | Done |

### 3.3 Экономический Базис (Economic Base)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-020 | Система ресурсов с 12+ типами (пища, древесина, камень, руда и т.д.) | P0 | Done |
| FR-021 | Инвентари для NPC и локаций | P0 | Done |
| FR-022 | 20+ методов производства (собирательство, охота, земледелие, ремесло) | P0 | Done |
| FR-023 | Технологическое древо с 40+ технологиями | P0 | Done |
| FR-024 | Эпохи развития (Первобытность → Каменный → Бронзовый → Железный век) | P0 | Done |
| FR-025 | Система собственности (COMMUNAL, PERSONAL, PRIVATE, FAMILY) | P0 | Done |
| FR-026 | Права собственности с правами использования и наследования | P1 | Done |
| FR-027 | Прибавочный продукт как основа накопления | P1 | Done |
| FR-028 | Технологии открываются через работу и обучение | P0 | Done |

### 3.4 Социальная Структура (Social Structure)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-030 | Семейная система (создание семей, браки, разводы) | P0 | Done |
| FR-031 | Наследование собственности внутри семьи | P1 | Done |
| FR-032 | Демография (рождения, смерти по факторам возраста/здоровья/голода) | P0 | Done |
| FR-033 | Жизненные этапы (младенец → ребёнок → подросток → взрослый → старик) | P0 | Done |
| FR-034 | Классовая система должна ВОЗНИКАТЬ из экономических отношений | P0 | Done |
| FR-035 | Классовое сознание и классовые конфликты | P1 | In Progress |
| FR-036 | Политическое влияние классов | P2 | Planned |

### 3.5 Культурная Надстройка (Cultural Superstructure)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-040 | Верования должны ВОЗНИКАТЬ из экономических условий | P0 | Done |
| FR-041 | Типы верований (анимизм, тотемизм, многобожие, священность собственности) | P0 | Done |
| FR-042 | Связь верований с классами (какому классу выгодно) | P1 | Done |
| FR-043 | Традиции и ритуалы, связанные с верованиями и сезонами | P1 | Done |
| FR-044 | Социальные нормы с штрафами за нарушения | P1 | Done |
| FR-045 | Совместимость и конфликты между верованиями | P2 | Done |

### 3.6 NPC (Non-Player Characters)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-050 | Базовые статы (сила, ловкость, интеллект, харизма, удача) 1-20 | P0 | Done |
| FR-051 | Навыки (бой, ремесло, торговля, земледелие, медицина) | P0 | Done |
| FR-052 | Система потребностей (голод, сон, социализация, развлечения) | P0 | Done |
| FR-053 | Личность через trait-систему (экстраверт/интроверт, трудолюбивый/ленивый) | P0 | Done |
| FR-054 | Отношения между NPC (дружба, враждебность, романтика) | P0 | Done |
| FR-055 | Генетика — наследование характеристик от родителей | P0 | Done |
| FR-056 | Мутации и генетическое разнообразие | P1 | Done |

### 3.7 Память NPC (NPC Memory - Generative Agents)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-060 | Поток памяти (Memory Stream) — все события в жизни NPC | P0 | Done |
| FR-061 | Рефлексия — NPC делает выводы из опыта | P0 | Done |
| FR-062 | Важность события определяет, что помнить | P1 | Done |
| FR-063 | Связи между воспоминаниями | P1 | Done |
| FR-064 | Планирование на основе памяти | P1 | Done |

### 3.8 ИИ и Принятие Решений (AI & Decision Making)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-070 | BDI-архитектура (Beliefs, Desires, Intentions) | P0 | Done |
| FR-071 | Beliefs — убеждения NPC о мире и других NPC | P0 | Done |
| FR-072 | Desires — потребности и цели | P0 | Done |
| FR-073 | Intentions — выбранные планы действий | P0 | Done |
| FR-074 | Планирование на день | P1 | Done |
| FR-075 | Реагирование на события | P1 | Done |
| FR-076 | Личность влияет на выбор между вариантами | P0 | Done |
| FR-077 | Время суток влияет на поведение (работа днём, сон ночью) | P1 | Done |

### 3.9 Пользовательский Интерфейс (User Interface)

| ID | Требование | Приоритет | Статус |
|----|-----------|-----------|--------|
| FR-080 | CLI интерфейс для управления симуляцией | P0 | Done |
| FR-081 | Просмотр списка жителей | P0 | Done |
| FR-082 | Просмотр информации о конкретном NPC | P0 | Done |
| FR-083 | Просмотр локаций | P0 | Done |
| FR-084 | Просмотр последних событий | P0 | Done |
| FR-085 | Авто-симуляция | P1 | Done |
| FR-086 | Социальная сеть (граф отношений) | P1 | Done |
| FR-087 | Визуализация карты | P1 | Done |
| FR-088 | Графический интерфейс (pygame/terminal) | P2 | Planned |

---

## 4. Нефункциональные Требования (Non-Functional Requirements)

### 4.1 Производительность (Performance)

| ID | Требование | Целевое значение |
|----|-----------|------------------|
| NFR-001 | Время обновления одного часа симуляции | < 100ms для 100 NPC |
| NFR-002 | Потребление памяти | < 500MB для 1000 NPC |
| NFR-003 | Скорость генерации мира | < 5 секунд для мира 40x40 |

### 4.2 Масштабируемость (Scalability)

| ID | Требование | Целевое значение |
|----|-----------|------------------|
| NFR-010 | Максимальная популяция | 1000+ NPC |
| NFR-011 | Максимальный размер карты | 100x100 |
| NFR-012 | Максимальная длительность симуляции | 10000+ лет |

### 4.3 Надёжность (Reliability)

| ID | Требование | Описание |
|----|-----------|----------|
| NFR-020 | Детерминистичность | При одинаковом seed мир развивается одинаково |
| NFR-021 | Устойчивость к ошибкам | Ошибка в одном NPC не останавливает симуляцию |
| NFR-022 | Валидация данных | Все параметры проверяются на корректность |

### 4.4 Модифицируемость (Modifiability)

| ID | Требование | Описание |
|----|-----------|----------|
| NFR-030 | Модульная архитектура | Подсистемы независимы и заменяемы |
| NFR-031 | Конфигурируемость | Все параметры вынесены в config |
| NFR-032 | Расширяемость | Легко добавить новые ресурсы, технологии, верования |

### 4.5 Документация (Documentation)

| ID | Требование | Описание |
|----|-----------|----------|
| NFR-040 | Код документирован | Docstrings для всех классов и методов |
| NFR-041 | README актуален | Описание запуска и архитектуры |
| NFR-042 | Архитектурная документация | Диаграммы и описание системы |

---

## 5. Ограничения (Constraints)

### 5.1 Технические Ограничения

| ID | Ограничение | Причина |
|----|-------------|---------|
| CON-001 | Python 3.11+ | Использование современных фич языка |
| CON-002 | Без внешних зависимостей для ядра | Простота развёртывания |
| CON-003 | Текстовый UI первичен | Фокус на логике, не на графике |

### 5.2 Философские Ограничения

| ID | Ограничение | Причина |
|----|-------------|---------|
| CON-010 | Классы НЕ задаются жёстко | Emergent-система |
| CON-011 | Культура зависит от экономики | Марксистская модель |
| CON-012 | NPC автономны | BDI-архитектура |

---

## 6. Риски и Допущения (Risks & Assumptions)

### 6.1 Риски

| ID | Риск | Вероятность | Влияние | Митигация |
|----|------|-------------|---------|-----------|
| RISK-001 | Производительность при большой популяции | Средняя | Высокое | Оптимизация, пакетная обработка |
| RISK-002 | Emergent-системы могут быть непредсказуемы | Высокая | Среднее | Логирование, анализ |
| RISK-003 | Сложность балансировки параметров | Средняя | Среднее | Множественные тесты, пресеты |

### 6.2 Допущения

| ID | Допущение |
|----|-----------|
| ASM-001 | Марксистская модель адекватно описывает развитие общества |
| ASM-002 | BDI-архитектура достаточна для моделирования поведения |
| ASM-003 | Генетическое наследование черт реалистично |
| ASM-004 | Memory Stream достаточен для "памяти" NPC |

---

## 7. Глоссарий (Glossary)

| Термин | Определение |
|--------|-------------|
| **Базис** | Экономическая структура общества (производительные силы + производственные отношения) |
| **Надстройка** | Культура, идеология, политика, право — определяемые базисом |
| **Emergent** | Возникающий из взаимодействия компонентов, а не заданный жёстко |
| **BDI** | Beliefs-Desires-Intentions — архитектура автономных агентов |
| **Memory Stream** | Поток памяти — все события в жизни NPC (из Generative Agents) |
| **Рефлексия** | Процесс формирования выводов из опыта |
| **NPC** | Non-Player Character — неигровой персонаж |
| **Trait** | Черта характера (экстраверт, трудолюбивый и т.д.) |

---

## 8. Открытые Вопросы (Open Questions)

| ID | Вопрос | Приоритет | Ответственный |
|----|--------|-----------|---------------|
| OQ-001 | Как визуализировать классовую структуру? | P2 | UX |
| OQ-002 | Какой графический движок использовать? | P2 | Architect |
| OQ-003 | Нужна ли система квестов/событий? | P3 | PM |
| OQ-004 | Как реализовать сохранение/загрузку мира? | P2 | Dev |
| OQ-005 | Нужна ли интеграция с LLM для диалогов? | P3 | Architect |

---

## 9. Исследовательские Материалы (Research References)

Подробная информация о теоретических основах проекта доступна в исследовательских документах:

| Документ | Описание | Ключевые темы |
|----------|----------|---------------|
| [Agent Simulations](research/agent-simulations.md) | Лучшие практики создания агентных симуляций | BDI, Generative Agents, Utility AI, Emergent Narrative |
| [Marxism Guide](research/marxism-guide.md) | Марксистская теория для моделирования | Базис/Надстройка, Классы, Прибавочная стоимость, Идеология |

### Ключевые Источники

**Агентные симуляции:**
- Generative Agents (Stanford, 2023) — Memory Stream, Reflection
- BDI Architecture (Bratman) — Beliefs, Desires, Intentions
- Dwarf Fortress — Emergent Narrative
- The Sims — Utility AI, Needs System

**Марксистская теория:**
- Marx, K. "Das Kapital" — Прибавочная стоимость, Эксплуатация
- Marx & Engels "The German Ideology" — Исторический материализм
- Gramsci "Prison Notebooks" — Гегемония, Ложное сознание

---

## 10. История Изменений (Change History)

| Версия | Дата | Автор | Описание |
|--------|------|-------|----------|
| 1.0 | 2026-01-31 | PM Agent | Первоначальная версия PRD |
| 1.1 | 2026-01-31 | PM Agent | Добавлены ссылки на исследования |

---

*Документ создан по методологии [BMAD-METHOD](https://github.com/bmad-code-org/BMAD-METHOD)*
