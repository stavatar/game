---
title: Окружение и Мир - Система Карты, Климата и Локаций
description: Система управления миром, карта с двойным представлением, координатная система, типы территорий, биомы, климат, сезоны, погода, катаклизмы, распределение ресурсов, локации
keywords:
  - мир
  - карта
  - координаты
  - координатная система
  - климат
  - сезоны
  - погода
  - катаклизмы
  - бедствия
  - ресурсы
  - локации
  - территории
  - биомы
lang: ru
---

# Окружение и Мир - Система Карты, Климата и Локаций

## Обзор

Система окружения («Живого Мира») обеспечивает полнофункциональное моделирование игрового мира с реалистичным климатом, геологией и локациями. Это фундамент, на котором строятся все остальные системы: экономика зависит от климата, общество зависит от ресурсов, которые определяются территорией и климатом.

**Ключевые компоненты:**
- **WorldMap** — система карты мира с двойным представлением (сетка + непрерывные координаты)
- **Terrain** — типы территорий, биомы и свойства клеток
- **ClimateSystem** — управление сезонами, погодой и катаклизмами
- **Location** — система локаций для размещения NPC и социального взаимодействия
- **Position** — система непрерывных координат для перемещения

---

## 1. Система Карты Мира

### 1.1 Архитектура: Двойное Представление

Карта мира использует **двойное представление** координат и объектов:

```
┌─────────────────────────────────────┐
│    СИСТЕМА КАРТЫ (WorldMap)        │
├─────────────────────────────────────┤
│  СЕТКА (Дискретные координаты)     │
│  - Клетки размер 1х1               │
│  - Территории (9 типов)            │
│  - Ресурсы                         │
│  - Постройки                       │
│  - Владение землёй                 │
│  (x: int, y: int) → Tile           │
├─────────────────────────────────────┤
│  НЕПРЕРЫВНОЕ ПРОСТРАНСТВО          │
│  - Точные позиции NPC             │
│  - Плавное перемещение             │
│  - Точные расстояния               │
│  (x: float, y: float) → Position   │
└─────────────────────────────────────┘
```

**Причина двойного представления:**
- **Сетка**: Эффективна для управления ресурсами, территориями, постройками
- **Непрерывное пространство**: Позволяет реалистичное перемещение персонажей внутри и между клетками

### 1.2 Координатная Система

#### Сетка (Tile Coordinates)
```python
# Целые координаты сетки
tile_coord: Tuple[int, int] = (x: int, y: int)

# Пример:
tile_at = world_map.tiles[(25, 30)]  # Клетка в координатах 25,30
```

**Диапазон координат:**
- Стандартный размер: **50 × 50** клеток
- Расширяемо до любого размера
- Каждая клетка занимает площадь 1×1 единиц

#### Непрерывное Пространство (World Coordinates)
```python
# Вещественные координаты
position: Position = Position(x: float, y: float)

# Операции:
dist = pos1.distance_to(pos2)          # Расстояние между точками
grid_pos = position.to_grid()          # Конвертация в сетку
new_pos = pos.move_towards(target, speed)  # Перемещение
```

**Конвертация между системами:**
```python
# Сетка → Непрерывное пространство
position = Position(x + 0.5, y + 0.5)  # Центр клетки

# Непрерывное → Сетка
grid_x, grid_y = int(pos.x), int(pos.y)
```

### 1.3 Процедурная Генерация Карты

Карта генерируется с использованием **процедурного шума Перлина**:

```
1. Генерация карты высот (elevation)
   └─ Определяет горы, холмы, равнины

2. Генерация карты влажности (moisture)
   └─ Определяет леса, пустыни, болота

3. Синтез: высота + влажность → тип территории

4. Генерация реки (от гор к низине)
```

**Параметры генерации:**
- **Seed**: Число для воспроизводимости (default: random)
- **Scale**: Масштаб шума (0.1 для высот, 0.08 для влажности)
- **Октавы**: 4 октавы для естественных переходов

**Пример инициализации:**
```python
world_map = WorldMap(width=50, height=50, seed=12345)
# Каждый раз с одинаковым seed даст одинаковую карту
```

### 1.4 Индексы для Быстрого Поиска

WorldMap поддерживает кэшированные индексы для эффективного поиска:

```python
_water_tiles: Set[Tuple[int, int]]      # Все водяные клетки
_forest_tiles: Set[Tuple[int, int]]     # Все лесные клетки
_fertile_tiles: Set[Tuple[int, int]]    # Все плодородные клетки
```

**Использование:**
```python
# Найти все водные клетки
water = world_map._water_tiles

# Найти лесные клетки для сбора древесины
forests = world_map._forest_tiles
```

---

## 2. Типы Территорий и Биомы

### 2.1 Типы Территорий

Система поддерживает **9 типов территорий**:

| Тип | Символ | Плодородность | Стоимость движения | Можно строить | Ресурсы |
|-----|--------|---------------|--------------------|---------------|---------|
| **Вода** | ~ | 0.0 | 5.0 | ❌ | рыба, вода |
| **Равнина** | . | 0.7 | 1.0 | ✅ | трава, дичь |
| **Лес** | ♠ | 0.4 | 1.5 | ✅ | древесина, дичь, ягоды, грибы |
| **Густой лес** | ♣ | 0.2 | 2.5 | ❌ | древесина, дичь, ягоды, мёд |
| **Холмы** | ∩ | 0.3 | 2.0 | ✅ | камень, руда |
| **Горы** | ▲ | 0.0 | 4.0 | ❌ | камень, руда, драгоценности |
| **Болото** | ≈ | 0.1 | 3.0 | ❌ | торф, ягоды, лекарственные травы |
| **Степь** | : | 0.2 | 1.2 | ✅ | трава, дичь |

### 2.2 Свойства Территории

Каждый тип территории имеет следующие **свойства**:

```python
@dataclass
class TerrainProperties:
    name: str                    # Названи (например, "лес")
    symbol: str                  # Символ для ASCII-карты
    color: str                   # Цвет для GUI
    movement_cost: float         # Стоимость перемещения (1.0 = норма)
    fertility: float             # Плодородность (0.0 - 1.0)
    building_allowed: bool       # Можно ли строить здания
    base_resources: List[str]    # Доступные ресурсы
    shelter_value: float = 0.0   # Укрытие от стихии (0.0 - 1.0)
    danger_level: float = 0.0    # Опасность (0.0 - 1.0)
```

**Примеры:**
- **Равнина**: высокая плодородность, низкая опасность, подходит для ферм
- **Густой лес**: укрывает от непогоды, опасен, трудно проходить
- **Горы**: ценные ресурсы (руды, драгоценности), не пригодны для строительства

### 2.3 Биомы

Система поддерживает **5 основных биомов**, определяющих климат:

```python
class BiomeType(Enum):
    TEMPERATE = auto()      # Умеренный климат (стандарт)
    BOREAL = auto()         # Северный (тайга, суровые зимы)
    TROPICAL = auto()       # Тропический (тёплый, влажный)
    ARID = auto()           # Засушливый (пустыни, степи)
    TUNDRA = auto()         # Тундра (вечная мерзлота, холод)
```

**Влияние биома:**
- Определяет базовые температурные диапазоны
- Влияет на частоту определённых типов погоды
- Влияет на доступность ресурсов
- Влияет на здоровье NPC

### 2.4 Состояние Клетки (Tile)

Каждая клетка имеет текущее состояние:

```python
@dataclass
class Tile:
    x, y: int                    # Координаты
    terrain: TerrainType         # Тип территории
    biome: BiomeType             # Биом
    elevation: float             # Высота (0-1, где 0.5 = уровень моря)
    moisture: float              # Влажность почвы (0-1)

    # Текущее состояние
    fertility_modifier: float = 1.0  # Множитель плодородия
    is_flooded: bool = False         # Затоплено ли
    is_burning: bool = False         # Лесной пожар

    # Владение
    owner_id: Optional[str] = None   # Кто владеет (ID NPC/поселения)
    claimed_by: Optional[str] = None # Кто претендует
    building_id: Optional[str] = None# ID постройки на клетке
```

**Методы клетки:**
```python
tile.get_properties()           # Получить свойства типа территории
tile.get_effective_fertility(season)  # Эффективная плодородность с модификаторами
tile.get_symbol()               # Символ для отображения (постройка, пожар, вода)
tile.can_build()                # Можно ли строить на этой клетке
tile.can_farm()                 # Можно ли заниматься земледелием
```

---

## 3. Система Климата

### 3.1 Циклы и Сезоны

**Календарь:**
- **1 год** = 360 дней
- **4 сезона** = 90 дней каждый

```
Весна (дни 0-89)    → Сбор, охота, посев
Лето (дни 90-179)   → Максимальная производительность
Осень (дни 180-269) → Сбор урожая, заготовки
Зима (дни 270-359)  → Минимальная продуктивность
```

**Система обновления:**
```python
def _get_season(day_of_year: int) -> Season:
    if day_of_year < 90:
        return Season.SPRING
    elif day_of_year < 180:
        return Season.SUMMER
    # ...
```

### 3.2 Погода и Условия

#### Типы Погоды

```python
class WeatherType(Enum):
    CLEAR = "ясно"         # Идеальные условия
    CLOUDY = "облачно"     # Небольшое снижение производства
    RAIN = "дождь"         # Хорошо для земледелия, плохо для охоты
    HEAVY_RAIN = "ливень"  # Серьёзное снижение производства
    STORM = "гроза"        # Критическое снижение, опасность
    SNOW = "снег"          # Зимняя погода
    BLIZZARD = "метель"    # Критическое снижение всего
    FOG = "туман"          # Плохо для охоты и путешествий
    HEAT = "жара"          # Летняя жара
    FROST = "мороз"        # Минусовая температура
```

#### Погодные Условия

```python
@dataclass
class WeatherConditions:
    weather_type: WeatherType
    temperature: float           # Градусы Цельсия
    humidity: float              # 0-1
    wind_strength: float         # 0-1

    # Модификаторы для производства
    farming_modifier: float      # Влияние на земледелие
    hunting_modifier: float      # Влияние на охоту
    gathering_modifier: float    # Влияние на собирательство
    travel_modifier: float       # Влияние на путешествия
    health_modifier: float       # Влияние на здоровье
```

#### Модификаторы Погодой

Каждый тип погоды влияет на производительность:

| Погода | Земледелие | Охота | Собирательство | Путешествие | Здоровье |
|--------|-----------|-------|----------------|------------|----------|
| **Ясно** | 1.0 | 1.0 | 1.0 | 1.0 | 1.0 |
| **Облачно** | 0.9 | 1.0 | 1.0 | 1.0 | 1.0 |
| **Дождь** | 1.2 | 0.7 | 1.0 | 0.8 | 1.0 |
| **Ливень** | 0.8 | 0.4 | 0.8 | 0.5 | 0.9 |
| **Гроза** | 0.5 | 0.2 | 0.5 | 0.3 | 0.8 |
| **Снег** | 0.1 | 0.6 | 0.6 | 0.6 | 0.9 |
| **Метель** | 0.0 | 0.1 | 0.1 | 0.2 | 0.7 |
| **Туман** | 1.0 | 0.5 | 1.0 | 0.7 | 1.0 |
| **Жара** | 0.7 | 1.0 | 1.0 | 0.8 | 0.85 |
| **Мороз** | 0.0 | 1.0 | 0.3 | 1.0 | 0.8 |

### 3.3 Сезонная Производительность

Каждый сезон влияет на доступность ресурсов:

```python
season_mods = {
    Season.SPRING: {"farming": 0.8, "hunting": 1.0, "gathering": 0.7, "fishing": 1.0},
    Season.SUMMER: {"farming": 1.0, "hunting": 0.9, "gathering": 1.0, "fishing": 0.9},
    Season.AUTUMN: {"farming": 1.2, "hunting": 1.1, "gathering": 1.2, "fishing": 0.8},
    Season.WINTER: {"farming": 0.0, "hunting": 0.7, "gathering": 0.2, "fishing": 0.4},
}
```

**Интерпретация:**
- **Весна**: Посевная, охота хороша, собирательство слабое
- **Лето**: Максимум земледелия, рост
- **Осень**: Сбор урожая (пиковое земледелие), охота активна
- **Зима**: Земледелие невозможно, охота сложна, собирательство минимально

### 3.4 Долгосрочные Тренды

Климат медленно меняется со временем:

```python
self.global_temperature_offset: float = 0.0  # Изменение климата
self.drought_years: int = 0                  # Количество засушливых лет подряд
self.wet_years: int = 0                      # Количество влажных лет подряд
```

**Механика:**
- Каждый год глобальная температура меняется на ±0.1°C (случайно)
- Ограничена в диапазоне -3°C до +5°C
- Отражает долгосрочные климатические изменения
- Влияет на общую продуктивность и доступность ресурсов

---

## 4. Система Катаклизмов

### 4.1 Типы Катаклизмов

```python
class DisasterType(Enum):
    DROUGHT = "засуха"           # 0.1% в лето, нет почвы для ферм
    FLOOD = "наводнение"         # 0.05% в весну/осень, затопленные поля
    PLAGUE = "мор"               # 0.02%, болезни убивают жителей
    FAMINE = "голод"             # 0.02%, нехватка пищи
    FIRE = "пожар"               # 0.03% в лето, сжигает постройки
    HARSH_WINTER = "суровая зима"  # 0.2% в зиму, люди мёрзнут
    LOCUST = "нашествие саранчи" # 0.02% в лето, уничтожает поля
```

### 4.2 Механика Катаклизмов

```python
@dataclass
class Disaster:
    disaster_type: DisasterType
    severity: float              # 0-1 (0.3-1.0 при создании)
    duration_days: int           # 10-60 дней
    days_remaining: int          # Оставшихся дней

    affected_area: List[Tuple[int, int]]  # Координаты затронутых клеток
    casualties: int = 0          # Жертвы среди NPC
    resources_lost: Dict[str, float]      # Потеряные ресурсы
```

**Жизненный цикл катаклизма:**
1. **Начало**: Случайная генерация на основе вероятности
2. **Активность**: Каждый день длительность уменьшается на 1
3. **Действие**: Модификаторы применяются к производству
4. **Завершение**: После истечения времени добавляется в историю

### 4.3 Влияние Катаклизмов на Производство

```python
modifiers = {
    DisasterType.DROUGHT: {"farming": 0.3},        # Ферма × 0.3
    DisasterType.FLOOD: {"farming": 0.2, "travel": 0.4},
    DisasterType.PLAGUE: {"health": 0.5},
    DisasterType.FAMINE: {"health": 0.7},
    DisasterType.FIRE: {},  # Специальная обработка
    DisasterType.HARSH_WINTER: {"health": 0.7},
    DisasterType.LOCUST: {"farming": 0.1},
}
```

### 4.4 Вероятность Катаклизмов

**Базовые вероятности:**
```python
disaster_chances = {
    DisasterType.DROUGHT: 0.001 в лето / 0.0001 иначе,
    DisasterType.FLOOD: 0.0005 в весну/осень / 0.0001 иначе,
    DisasterType.PLAGUE: 0.0002,
    DisasterType.FIRE: 0.0003 в лето / 0.0001 иначе,
    DisasterType.HARSH_WINTER: 0.002 в зиму / 0 иначе,
    DisasterType.LOCUST: 0.0002 в лето / 0 иначе,
}
```

**Корректировка вероятности:**
```python
adjusted_chance = chance * (1 + year * 0.01)
```

Вероятность растёт с течением времени, чтобы обеспечить периодические события.

---

## 5. Распределение Ресурсов

### 5.1 Базовые Ресурсы

Каждый тип территории предоставляет определённые ресурсы:

| Территория | Ресурсы |
|----------|---------|
| **Вода** | рыба, вода |
| **Равнина** | трава, дичь |
| **Лес** | древесина, дичь, ягоды, грибы |
| **Густой лес** | древесина, дичь, ягоды, мёд |
| **Холмы** | камень, руда |
| **Горы** | камень, руда, драгоценности |
| **Болото** | торф, ягоды, лекарственные травы |
| **Степь** | трава, дичь |

### 5.2 Факторы, Влияющие на Доступность Ресурсов

**1. Плодородность клетки**
```
Эффективная плодородность = базовая × множитель × модификатор_сезона
```

**2. Влахгость почвы**
- Влажность < 0.2 (засуха): ×0.5
- Влажность > 0.8 (переувлажнение): ×0.8

**3. Сезон**
- Весна: ×0.8
- Лето: ×1.0
- Осень: ×0.6
- Зима: ×0.1

**4. Погода**
- Дождь: ×1.2 (хорошо для земледелия)
- Засуха: ×0.3 (очень плохо)
- Наводнение: ×0.2 (критично)

**5. Катаклизмы**
- Активный катаклизм дополнительно снижает доступность

### 5.3 Система Сбора Ресурсов

Ресурсы собираются через *трудовую деятельность*:
- **Земледелие**: выращивание на плодородных клетках
- **Охота**: на клетках с дичью
- **Собирательство**: сбор растительных ресурсов
- **Рыбалка**: на водных клетках
- **Добыча**: на холмах и горах

**Формула производства:**
```
производство = базовое × плодородность × модификатор_погоды × модификатор_сезона
```

---

## 6. Система Локаций

### 6.1 Типы Локаций

```python
class LocationType(Enum):
    HOME = "дом"               # Жилые дома
    TAVERN = "таверна"         # Питание, комнаты, слухи
    MARKET = "рынок"           # Торговля
    SHOP = "магазин"           # Покупка/продажа товаров
    BLACKSMITH = "кузница"     # Производство оружия
    FARM = "ферма"             # Сельскохозяйственные работы
    CHURCH = "церковь"         # Религиозные обряды
    TOWN_SQUARE = "площадь"    # Публичные собрания
    BARRACKS = "казармы"       # Военные
    CASTLE = "замок"           # Политическая власть
    FOREST = "лес"             # Охота, собирательство
    ROAD = "дорога"            # Путешествие
    MINE = "шахта"             # Добыча ресурсов
    LIBRARY = "библиотека"     # Знания
    HOSPITAL = "лечебница"     # Лечение
    GUILD_HALL = "гильдия"     # Ремесленники
```

### 6.2 Свойства Локации

```python
@dataclass
class Location:
    id: str                          # Уникальный ID
    name: str                        # Название
    location_type: LocationType      # Тип
    description: str                 # Описание

    capacity: int = 20               # Максимум NPC
    current_npcs: Set[str]           # ID текущих NPC
    connected_locations: Set[str]    # Соседние локации

    owner_id: Optional[str]          # Владелец (NPC или поселение)

    wealth_level: int = 50           # Богатство (0-100)
    prices_modifier: float = 1.0     # Модификатор цен

    is_public: bool = True           # Доступ открыт
    open_hours: tuple = (6, 22)      # Часы работы

    available_services: List[str]    # Услуги
    available_items: Dict[str, int]  # Товары
```

### 6.3 Функциональность Локаций

**Управление NPC:**
```python
location.add_npc(npc_id)        # Добавить NPC
location.remove_npc(npc_id)     # Удалить NPC
location.is_full()               # Заполнена ли
location.get_npc_count()         # Количество NPC
```

**Доступность:**
```python
location.is_open(hour)           # Открыта ли в этот час
location.get_service_description()  # Описание услуг
```

**Примеры создания локаций:**
```python
tavern = Location.create_tavern("Весёлый Конь")
# capacity=30, services=["еда", "выпивка", "комната", "слухи"]
# open_hours=(10, 2)  # 10:00-02:00

market = Location.create_market("Центральный рынок")
# capacity=50, services=["торговля", "новости"]
# open_hours=(7, 18)  # 07:00-18:00

home = Location.create_home("Дом Иванова", owner_id="npc_123")
# capacity=6, is_public=False, services=["отдых", "еда"]
# open_hours=(0, 24)  # Всегда открыт для хозяина
```

---

## 7. Интеграция с Другими Системами

### 7.1 Окружение → Экономика

```
Климат и ресурсы определяют экономику:
├─ Доступные ресурсы → базовые товары для торговли
├─ Плодородность → возможность земледелия
├─ Погода → модификаторы производства
└─ Катаклизмы → нехватка ресурсов, цены растут
```

### 7.2 Окружение → Общество

```
Мир влияет на демографию и структуру:
├─ Ресурсы → возможность поддержания населения
├─ Климат → миграция в поиске лучших условий
├─ Локации → образование поселений
└─ Катаклизмы → социальные потрясения
```

### 7.3 Окружение → NPC

```
NPC реагируют на окружение:
├─ Поиск ресурсов → перемещение на плодородные земли
├─ Избегание опасности → уход от катаклизмов
├─ Поселения → создание вблизи благоприятных локаций
└─ Адаптация → выбор занятий на основе климата
```

### 7.4 Система Обновления

**В каждом часу симуляции:**
```
1. Обновление времени суток

2. Если новый день:
   ├─ Обновление климата (погода, сезон)
   ├─ Обновление катаклизмов
   ├─ Проверка новых катаклизмов
   └─ Применение модификаторов к производству

3. Эффекты на экономику и NPC используют текущие условия

4. Если новый год:
   └─ Долгосрочные климатические тренды
```

---

## 8. Текущее Состояние

### 8.1 Реализованные Компоненты

✅ **WorldMap**
- Двойное представление координат (сетка + непрерывное)
- Процедурная генерация с шумом Перлина
- Индексы для быстрого поиска
- Поиск пути (A*)
- Генерация рек

✅ **Terrain System**
- 9 типов территорий
- 5 биомов
- Свойства плодородности, движения, опасности
- Система ресурсов

✅ **ClimateSystem**
- 4 сезона (90 дней каждый)
- 10 типов погоды
- Модификаторы для производства
- 7 типов катаклизмов
- Долгосрочные тренды температуры
- История бедствий

✅ **Location System**
- 16 типов локаций
- Управление NPC в локациях
- Системаотно работы (открытия/закрытия)
- Услуги и товары
- Владение локациями

### 8.2 Параметры и Константы

| Параметр | Значение |
|----------|----------|
| Размер карты (default) | 50 × 50 |
| Дни в году | 360 |
| Дни в сезоне | 90 |
| Октавы шума | 4 |
| Точность координат | float (±0.01) |
| Max активных катаклизмов | ∞ (по типам) |
| Range температуры | -15°C до +30°C |
| Range плодородности | 0.0 - 1.0 |
| Range влажности | 0.0 - 1.0 |

---

## 9. Планируемые Улучшения

### 9.1 Краткосрочные

- [ ] **Система миграции животных**: Популяции дичи, рыбы меняют локацию по сезонам
- [ ] **Стихийные бедствия на карте**: Визуальные эффекты пожаров, наводнений
- [ ] **Динамическое изменение карты**: Катаклизмы меняют структуру (горные обвалы, оползни)
- [ ] **Интеграция с построениями**: Постройки зависят от типа территории и климата

### 9.2 Среднесрочные

- [ ] **Система торговли ресурсами**: Территории специализируются на определённых ресурсах
- [ ] **Влияние на здоровье NPC**: Климат влияет на заболеваемость и смертность
- [ ] **Система воды**: Реки как источники питьевой воды и торговли
- [ ] **Экосистема**: Цепи питания, влияние охоты на популяции
- [ ] **Сезонная миграция населения**: NPC переходят ближе к благоприятным локациям

### 9.3 Долгосрочные

- [ ] **Эволюция ландшафта**: Медленные геологические изменения
- [ ] **Воздействие человека на климат**: Вырубка лесов, строительство меняют климат
- [ ] **Система освоения**: Постепенное расширение обитаемых и пригодных территорий
- [ ] **Региональные климаты**: Разные регионы имеют свои климатические зоны
- [ ] **Цикл Миланковича**: Очень долгосрочные климатические циклы

---

## 10. Примеры Использования

### 10.1 Создание и Инициализация Карты

```python
from src.world.world import World

# Создание мира
world = World(map_width=50, map_height=50, seed=12345)

# Доступ к компонентам
world_map = world.world_map
climate_system = world.climate_system

# Получение клетки
tile = world_map.get_tile(25, 30)
print(f"Территория: {tile.get_properties().name}")
print(f"Плодородность: {tile.get_effective_fertility('лето'):.2f}")
```

### 10.2 Работа с Климатом

```python
# Обновление климата
climate_events = climate_system.update(day=1, year=1)

# Получение статуса
report = climate_system.get_status_report()
print(report)
# Output:
# Сезон: весна
# Погода: дождь, прохладно (10°)
# Климатический тренд: потепление

# Получение производительности
productivity = climate_system.get_season_productivity()
print(f"Земледелие: ×{productivity['farming']:.1f}")
```

### 10.3 Работа с Локациями

```python
# Создание локации
tavern = Location.create_tavern("Весёлый Конь")
tavern.owner_id = "npc_merchant_001"

# Добавление NPC
if tavern.add_npc("npc_john"):
    print("Джон вошёл в таверну")

# Проверка открытости
if tavern.is_open(hour=18):
    print(f"Таверна открыта. Люди: {tavern.get_npc_count()}")
else:
    print("Таверна закрыта")
```

### 10.4 Поиск по Территориям

```python
# Найти все плодородные земли
fertile_lands = world_map._fertile_tiles
print(f"Плодородных клеток: {len(fertile_lands)}")

# Найти ближайший источник древесины
def find_nearest_resource(pos: Position, resource: str):
    for tile_coord in world_map._forest_tiles:
        tile = world_map.tiles[tile_coord]
        if resource in tile.get_properties().base_resources:
            # Найдена древесина
            return tile_coord
    return None

# Использование
from src.world.map import Position
npc_pos = Position(25.5, 30.5)
# Поиск ближайшей древесины
```

---

## 11. Ссылки и Связанные Системы

- **Система Симуляции** (`3_SIMULATION_CORE.md`): Основной цикл, в который интегрирован климат
- **Система Экономики** (`4_ECONOMIC_SYSTEM.md`): Производство зависит от климата и ресурсов
- **Система Общества** (`5_SOCIETY_SYSTEM.md`): Социальная структура зависит от ресурсов
- **Система Культуры** (`6_CULTURE_SYSTEM.md`): Верования реагируют на климатические события
- **Система NPC** (`7_NPC_SYSTEM.md`): NPC реагируют на погоду и климат через BDI

---

## 12. Заключение

Система окружения создаёт реалистичный и динамичный игровой мир, который влияет на все остальные системы. Двойное представление координат позволяет эффективно управлять как макро-уровнем (территории, ресурсы), так и микро-уровнем (движение NPC, точные позиции).

Климатическая система обеспечивает долгосрочные циклы, что создаёт достаточно вариативности и вызовов для NPC и игрока. Интеграция с другими системами через модификаторы и ограничения создаёт связную экосистему, где все влияет на всё.
